<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Harmonische Reihe – global</title>
  <script>
  window.MathJax = {
    tex: { inlineMath: [['\\(','\\)'], ['$', '$']], displayMath: [['\\[','\\]'], ['$$','$$']] },
    svg: { fontCache: 'global' }
  };
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
  <style>
    body{font-family:system-ui;margin:24px;background:#0b0f14;color:#e6edf3}
    .card{background:#121a23;border:1px solid #233244;border-radius:16px;padding:16px;max-width:980px}
    .row{display:flex;gap:20px;flex-wrap:wrap;align-items:flex-end}
    .k{color:#9fb0c1;font-size:12px;text-transform:uppercase;letter-spacing:.08em}
    .v{font-size:22px;font-variant-numeric:tabular-nums}
    .mono{font-family:ui-monospace,Menlo,Consolas,monospace}
    .small{color:#b3c0cf;max-width:980px}
    .ok{color:#b7f7c4}
    .warn{color:#ffd89a}
    .err{color:#ffb4b4}
    a{color:#8ab4ff}
  </style>
</head>
<body>
  <h1>Harmonische Reihe (global)</h1>
  <p class="small">
    Diese Seite zeigt Zwischenwerte der harmonischen Reihe an. Die Reihe divergiert, tut das aber sehr, sehr, sehr langsam.
  </p>

  
  <div>
  \[
    H_n=\sum_{k=1}^{n}\frac{1}{k}.
  \]
</div>

  <div class="card">
    <div class="row">
      <div>
        <div class="k">Summe H<sub>n</sub></div>
        <div id="sum" class="v mono">…</div>
      </div>
      <div>
        <div class="k">n</div>
        <div id="n" class="v mono">…</div>
      </div>
      <div>
        <div class="k">zuletzt aktualisiert (UTC)</div>
        <div id="upd" class="v mono">…</div>
      </div>
      <div>
        <div class="k">letzte Abfrage</div>
        <div id="lastFetch" class="v mono">…</div>
      </div>
    </div>

    <p id="status" class="mono small"></p>
    
  </div>



  <script>
    const sumEl = document.getElementById('sum');
    const nEl = document.getElementById('n');
    const updEl = document.getElementById('upd');
    const lastFetchEl = document.getElementById('lastFetch');
    const statusEl = document.getElementById('status');

    function fmtNumber(x) {
      // Gut lesbar + stabil: 16 signifikante Stellen
      return Number(x).toPrecision(16);
    }

    function setStatus(msg, cls) {
      statusEl.className = `mono small ${cls || ''}`;
      statusEl.textContent = msg;
    }

    async function refresh() {
      try {
        // Cache busting: erzwingt frisches status.json trotz CDN/Browser-Cache
        const url = `./status.json?ts=${Date.now()}`;
        const r = await fetch(url, { cache: 'no-store' });
        if (!r.ok) throw new Error(`HTTP ${r.status}`);

        const j = await r.json();
        sumEl.textContent = fmtNumber(j.sum);
        nEl.textContent = String(j.n);

        // updated_at ist ISO-String in UTC (aus dem Workflow)
        const upd = j.updated_at ? new Date(j.updated_at) : null;
        updEl.textContent = upd ? upd.toISOString() : '—';

        lastFetchEl.textContent = new Date().toLocaleString();

        setStatus('OK – Daten erfolgreich aktualisiert.', 'ok');
      } catch (e) {
        setStatus(`Fehler beim Laden: ${e.message}`, 'err');
      }
    }

    // Sofort laden, dann alle 2 Sekunden aktualisieren
    refresh();
    setInterval(refresh, 2000);
  </script>
</body>
</html>
